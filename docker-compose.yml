# HealthFlow Clinic Portal - Docker Compose Configuration
# Version: 1.0.0

version: '3.8'

services:
  clinic-portal:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_AUTH_BASE_URL=${VITE_AUTH_BASE_URL:-http://209.38.231.84:4003}
        - VITE_API_BASE_URL=${VITE_API_BASE_URL:-http://209.38.231.84:4002}
        - VITE_API_VERSION=${VITE_API_VERSION:-v1}
        - VITE_APP_NAME=${VITE_APP_NAME:-HealthFlow Clinic Portal}
        - VITE_APP_VERSION=${VITE_APP_VERSION:-1.0.0}
    image: healthflow/clinic-portal:${VERSION:-1.0.0}
    container_name: healthflow-clinic-portal
    restart: unless-stopped
    ports:
      - "${PORT:-8080}:80"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - healthflow-network
    labels:
      - "com.healthflow.service=clinic-portal"
      - "com.healthflow.version=${VERSION:-1.0.0}"
      - "traefik.enable=true"
      - "traefik.http.routers.clinic-portal.rule=Host(`clinic.healthflow.gov.eg`)"
      - "traefik.http.services.clinic-portal.loadbalancer.server.port=80"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  healthflow-network:
    external: true
    name: healthflow-network

# Environment variables can be set in .env file:
# PORT=8080
# VERSION=1.0.0
# VITE_AUTH_BASE_URL=http://209.38.231.84:4003
# VITE_API_BASE_URL=http://209.38.231.84:4002
